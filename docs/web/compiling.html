<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"/>
<link rel="stylesheet" href="style.css" type="text/css"/>

<title>compiling.html</title></head><body>
<div id="header">
<h1>3Depict - Valued point cloud visualisation and analysis</h1>
<ul id="nav">
	<li><a href="index.html">Home</a></li>
	<li><a href="download.html">Download</a></li>
	<li><a href="questions.html">Questions</a></li>
	<li><a href="documentation.html">Documentation</a></li>
	<li><a href="contact.html">Contact</a></li>
	<li><a href="about.html">About</a></li>
</ul>
</div>

<div id="left">
<div class="box">
<h2> Latest version: 0.0.13</h2>
<p> <a href="https://sourceforge.net/projects/threedepict/files/">Download</a> the source code for the latest version of 3Depict for your platform</p>
</div>
<div class="box">
<h3>Stuck on how to compile?</h3>
Try asking for help on the <a href="https://sourceforge.net/apps/phpbb/threedepict/">forums</a>
<p></p>
</div>
<center>
<a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=341003&amp;type=2" alt="SourceForge.net Logo" border="0" height="37"/></a>
</center>
</div>
<div id="content">
<div id="right">

<h1>Source Compilation</h1>

Source compilation is tricky, and requires an in-depth knowledge of
both C++ programming and the internals of your computer's software. It
is fraught with <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Command_line">cryptic peril</a>;
you have been warned. If you are not familiar with the concept of
source compilation, or software development in general, this procedure
may prove very difficult. Some help is available on the forums, but
this is a limited and typically slow method of communication.<br/>

<br/>

Looking for an easier install? <a href="download.html">Check</a> to see if your platform is supported. If it is not supported, you can <a href="contact.html">contact the author</a> for other options.<br/><br/>
<hr/>
<h2>Getting started<br/>


</h2>

This project uses <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Autotools">autotools</a> to manage system configuration and program
dependency information, so if you know what that means and you are
running Linux, just do as per normal after installing dependencies
(.<span style="font-family: monospace;">/configure &amp;&amp; make &amp;&amp; make install</span>). <br/>
<br/>
Due to a missing build environment, building under
windows is highly complicated, and more thoroughly documented <a href="#windows">below</a>.<br/>
<br/>


Direct <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Software_library">Dependencies</a>: <br/>

<ul>
<li><a href="http://sourceforge.net/projects/ftgl/">ftgl</a></li>
<li><a href="http://freetype.org/">freetype2</a></li>
<li><a href="http://www.xmlsoft.org/">libxml2</a></li>
<li><a href="http://mathgl.sourceforge.net/">mathgl</a></li>
<li><a href="http://wxwidgets.org/">wxwidgets</a></li>
<li><a href="http://www.gnu.org/software/gettext/">gettext</a></li>
<li><a href="http://www.qhull.org/">qhull</a></li>
</ul>


There are two main stages to compiling, <br/>


<ul>
<li>setting up your computer to be able to build, and </li><li>actually building the program.</li>
</ul>



In the following instructions, <span style="text-decoration: underline; font-family: monospace;">$</span> and <span style="text-decoration: underline; font-family: monospace;">#</span> indicate to enter command at a command prompt, as either a normal user or as an <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Root_user">administrator</a>. Do not type the <span style="font-family: monospace;">$</span> or <span style="font-family: monospace;">#</span> when entering the commands. Commands to enter into the command line, or code snippets, are listed in a <span style="font-family: monospace;">fixed width font</span><br/>
<br/>

If there are any problems or flaws with the instructions, please <a href="contact.html">contact the author</a><br/><br/>

<h2>Get the code</h2>
Either <a href="https://sourceforge.net/projects/threedepict/files/">Download</a> the source code (<a href="https://secure.wikimedia.org/wikipedia/en/wiki/Tar.gz">.tar.gz</a> file ), or grab the <a href="http://mercurial.selenic.com">mercurial</a> repository using this clone command, or by opening the URL in your graphical mercurial client (the URL is the bit at the right)
<br/>
<br/>
<span style="font-family: monospace;">$ hg clone http://threedepict.hg.sourceforge.net:8000/hgroot/threedepict/threedepict</span>
<br/>
<br/>
You should then install the following packages (this requires administrative rights to your machine).:<br/>
<br/>


<h2>Setting up</h2>
<h3>Debian/Ubuntu:</h3>
<ul>
<li>build-essential</li><li>libwxgtk2.8-dev</li><li>libmgl-dev</li><li>libxml2-dev</li><li>libftgl-dev</li><li>libqhull-dev</li>
</ul>


This can be done through the command line (below), or using the gui (synaptic package manager)<br/>

<br/>

<span style="text-decoration: underline; font-family: monospace;">$</span><span style="font-family: monospace;"> sudo apt-get build-dep 3depict </span><br/>


<h3>Fedora/RedHat:</h3>

<ul>
<li>"Development Tools"&nbsp; group package</li><li>mathgl-devel</li><li>libxml2-devel</li><li>ftgl-devel</li><li>wxgtk-devel</li><li>qhull-devel</li>
</ul>


This can be done through either the command line, or through the GUI <br/>

<br/>


<span style="text-decoration: underline; font-family: monospace;">$</span><span style="font-family: monospace;"> yum groupinstall "Development Tools"</span><br/>

<span style="text-decoration: underline; font-family: monospace;">$</span><span style="font-family: monospace;"> yum install mathgl-devel libxml2-devel ftgl-devel wxgtk-devel qhull-devel</span><br/>
<br/>

<h3>OpenSuse:</h3>

<ul>
<li>wxGTK-devel</li><li>libxml2-devel</li><li>ftgl-devel</li><li>qhull-devel</li>
</ul>



This can be done either through the graphical interface (YaST) or at the command line.<br/>

<br/>


<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; $ zypper install -t devel_C_C++</span><br/>

<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; $ zypper install wxGTK-devel libxml2-devel ftgl-devel qhull-devel</span><br/>

&nbsp;&nbsp;&nbsp; <br/>

Unfortunately, mathgl is not available as a pre-built package for Suse.
You must therefore download and install it manually from the mathgl
website:<br/>

<ul>
<li><a href="http://mathgl.sourceforge.net/">http://mathgl.sourceforge.net/</a></li>
</ul>

<h4> Cross compiling</h4>
There is a cross compilation script available (0.0.13) in the packaging/mingw-debian-cross/ folder of the <a href="http://threedepict.hg.sourceforge.net/hgweb/threedepict/threedepict/summary">code repository</a>. This can be used to build 3Depict for windows platforms using a Debian or Debian-like host. The cross-compilation script is experimental, but will get you most of the way to a cross compiled version.  The script will download, patch and build all the neccessary dependencies automatically.

<br/>


<h3>Mac OS X</h3>

Mac OS does not have a proper package management system. You need XCode installed (<a href="http://developer.apple.com/mac/library/documentation/Xcode/Conceptual/XcodeCoexistence/Contents/Resources/en.lproj/Basics/Basics.html">here</a>). For the latest version of Snow Leopard for some reason this is not free, and you now are required to use the app store or something to get this or build gcc yourself (somehow) it appears. Considering GCC (the bit we need) is completely free (GPL), it is unclear what the deal is here.
Note that at time of writing the wxWidgets version provided with XCode is several years out-of-date and probably won't work. Please don't try to use any of the built-in libraries provided with XCode - you cannot mix and match library linkage, it simply won't work (crashes). There are some <a href="#Extra_notes_for_Mac_OSX">post-compile notes</a>, which <span style="font-weight: bold; font-style: italic;">must</span>&nbsp; be followed to build a usable program.<br/>

<br/>

There is an automatic dependency grabbing script in the 3Depict source
code under the "deps" folder. Run that (ensure you are connected to the
Internet) to automatically download, build and install all the software
dependencies. If it does not work, this is a bug, so let me know. <br/>
<br/>
To run the script, simply open terminal.app, navigate to the correct folder containing "getDeps", then type:<br/>
<br/>
<span style="font-family: monospace;">$ ./getDeps</span><br/>

<br/>
This will check your system for a compiler, and then will proceed to download and install the needed components in an automatic fashion.<br/>
<br/>


<h3><a name="From_Source_setup"></a>From Source (All&nbsp; other platforms)</h3>
For platforms not listed above (including windows), dependency source
compiling is the way to go if you don't have pre-built versions
available. Compiling from source is tricky, can fail due to version
mismatch, can break your current computer install, and is only
recommended for advanced users with a programming background. <br/>

<br/>

You must first install GCC for your platform, and be able to compile a
basic "hello world" program. Other compilers might work, but I cannot
tell you how to do this. If you don't know what that means, you may
need to seek assistance from someone who does. Ask your local computer-y
person.<br/>

<br/>

If your platform provides any of the following libraries in an easy to
install fashion, use that, but don't forget to install the development
components, if you choose this route. Otherwise,&nbsp; just follow the
below instructions.<br/>

<br/>

Install the development headers for your platform.&nbsp; Windows needs
MinGW/MSYS or TDM-GCC/MSYS (unless you know better), some instructions are <a href="http://wiki.wxwindows.org/HowTo:_Install_MSYS_and_MinGW_for_use_with_Eclipse_CDT#MSYS_installation">here</a>, and my notes are below.  Otherwise, you are largely <a href="https://www.google.com/">on your own</a>. Cygwin is <span style="font-style: italic;">not</span> recommended, as OpenGL may not work in the final program (without X11).&nbsp; Feel free to <a href="contact.html">ask for help</a>.<br/>





<h4>wxWidgets<br/>
</h4>

<ul>
	<li>Download the latest wxWidgets source code from <a href="http://www.wxwidgets.org/">http://www.wxwidgets.org/</a></li><li>Then extract the tarball/zip/whatever</li><li>Compile this with the following console command:<ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> ./configure --with-opengl --enable-unicode</span></li><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> make</span></li></ul></li><li>&nbsp;Install&nbsp; (as administrator)</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">#</span> make install</span></li></ul>
</ul>


<h4>LibPNG <br/>
</h4>

<ul>
<li>Download the latest libPNG (Unless running mac) <a href="http://www.libpng.org/pub/png/libpng.html">http://www.libpng.org/pub/png/libpng.html</a><ul><li>Copy the correct makefile to the base directory</li><li>Mac OSX : move scripts/makefile.darwin&nbsp; to the libpng dir, and rename it makefile</li><li>Windows: Not sure. I had to do a lot of fiddling to get this to
work. Essentially I pulled a makefile from the msysPORT code, and then
converted it from patch format to a usable makefile. I suggest looking
on the interwebs for instructions.</li></ul></li><li>Other platforms: move scripts/makefile.gcc to the libpng dir and rename it makefile</li><ul><li>&nbsp;Compile it with<span style="font-family: monospace;"> <span style="text-decoration: underline;">$</span> make</span></li><li>&nbsp;Install it with<span style="font-family: monospace;"> <span style="text-decoration: underline;">#</span> make install&nbsp;&nbsp;&nbsp; </span><br/>


    </ul>
    </li>
</ul>

<h4>&nbsp;Freetype</h4>

<ul>
<li>Download the latest freetype source code: <a href="http://www.freetype.org/">http://www.freetype.org/</a></li><li>Compile with</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> ./configure<br/>
      </span></li><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> make</span></li></ul><li>&nbsp;Install&nbsp; (as administrator)</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">#</span> make install</span></li></ul>
</ul>


<h4>&nbsp;FTGL<br/>
</h4>

<ul>
<li>Download the latest FTGL source code from <a href="http://sourceforge.net/projects/ftgl/">http://sourceforge.net/projects/ftgl/</a></li><li>Compile with</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> ./configure <br/>
      </span></li><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> make</span></li></ul><li>&nbsp;Install&nbsp; (as administrator)</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">#</span> make install</span></li></ul>
</ul>



<h4>libxml2</h4>

<ul>
<li>Download the latest libxml2 <a href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a></li><li>Compile with</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> ./configure <br/>
</span></li><li><span style="font-family: monospace;"><span style="text-decoration: underline;">$</span> make</span></li></ul><li>&nbsp;Install&nbsp; (as administrator)</li><ul><li><span style="font-family: monospace;"><span style="text-decoration: underline;">#</span> make install</span></li></ul>
</ul>


<h4>MathGL</h4>


<ul>
<li>Download the latest mathgl <a href="http://mathgl.sourceforge.net/">http://mathgl.sourceforge.net/</a></li><li>Compile this with:</li><ul style="font-family: monospace;"><li>$ ./configure --disable-gsl</li></ul><ul style="font-family: monospace;"><li>$ make</li></ul><li>Install with</li><ul><li style="font-family: monospace;"># make install</li></ul>
</ul>



<h2><a name="3Depict_Compilation"></a>3Depict Compilation</h2>


Run the "configure" script (as a normal user) with:<br/>


<br/>

<span style="font-family: monospace;">$ ./configure</span><br/>

<br/>

This script works out some of the specifics of your system. If it
fails, saying that it cannot locate ftgl, and you know you have the
headers and libraries installed, simply pass the directory for ftgl
with --with-ftgl-prefix=(wherever, for example /usr/ if ftgl is
installed in /usr/include and /usr/libs). A full list of possible
options (there are many) is available with:<br/>
<br/>

<span style="font-family: monospace;">$ ./configure --help</span>

<br/>
<br/>


build the project (again normal user) with:<br/>


<br/>

<span style="font-family: monospace;">$ make</span><br/>

<br/>

to run the program:<br/>


<br/>

<span style="font-family: monospace;">$ ./src/3Depict</span><br/>

<br/>

you can optionally install it (Excluding mac OS) with:<br/>

<br/>

<span style="font-family: monospace;"># make install</span><br/>

<h3><a name="Extra_notes_for_Mac_OSX"></a>Extra notes for Mac OSX<br/>

</h3>

To build a .app package (required to interact with the program), you need to run <br/>

<br/>

<span style="font-family: monospace;">$ makeMacOSXPackage</span><br/>


<br/>

You can even move this ".app" package to other computers (with the same OSX version), and it should work there. <br/>
<br/>

<h2><a href="windows"></a> Compile notes for windows </h2>
<p><i>
THese notes are a little outdated as of April 2013 - you may find some of the program versions have changed. Most of the notes should still be valid.  However, this is not how 3Depict is built for windows - we use the cross-compile method instead. This has been scripted and is much easier, but requires a Debian or Debian-like installation (we recommend using VirtualBox). If you still want to compile under normal windows, then read on.
</i>
</p>

<p> Before I post the full notes, this is very, very detailed and technical. But it means I have this working, and down to a fine art. Its a rough ride.</p>
<p>
You will need the 7zip file manager program or winrar to be able to open tar/gz files, as windows does not support this filetype, nor recognises it in the "web search" facility. (Its a standard gzip + archive file, note to windows devs : see <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Tgz">wikipedia on tar-gz</a>)</p>
<p>
This worked under windows 7. It probably works elsewhere too. Maybe. I *really* recommend using ubuntu or something; then you don't have to go through all these hoops.
</p>
<br/>
Files required to set up dependencies:
<ul>
<li>MSYS-1.0.11.exe</li>
<li>tdm-gcc-4.5.1.exe</li>
<li>lpng143.zip</li>
<li>freetype-2.3.12.tar.gz</li>
<li>gsl-1.14.tar.gz</li>
<li>zlib-1.2.5.tar.gz</li>
<li>libxml2-2.7.7.tar.gz</li>
<li>ftgl-2.1.3~rc5.tar.gz</li>
<li>mathgl-1.10.2.1.tar.gz</li>
<li>wxMSW-2.8.11.zip</li>
</ul>

<br/>
<h3>Setting up dependencies</h3>
<ul>
<li>
Installed TDM-GCC-4.51 (32bit) (all defaults +openmp)
</li>
<li>
 Installed MSYS-1.0.11
<ul>
<li>
	- Said "yes" to "have mingw installed (c:/MinGW32/)
</li>
</ul>
</li>
<li>
Use console provided by the big blue "m(sys)" shortcut now on desktop to do most of the following
</li>
<li>
Checked that<span style="font-family: monospace;">gcc --version</span> worked (should now spit out something like "gcc.exe (tdm-1) 4.5.1") 
</li>
</ul>
<h4>wxWidgets</h4>
<ul>
<li>
Extracted wxMSW-2.8.11.zip to C:</li>
<li>
ran <span style="font-family: monospace;">./configure --with-opengl --enable-unicode</span> inside c:\wxMSW-2.8.11\
</li>
<li>
ran <span style="font-family: monospace;">make</span>. This will take a long time to run. (make can of course be sped up on multi-cpu systems with <span style="font-family: monospace;">make -j(#CPU)</span> (eg <span style="font-family: monospace;">make -j4</span>) to enable parallel compilation
</li>
<li>
 Checked that the openGL wxWidgets sample works. 
<ul>
<li>
	 <span style="font-family: monospace;">cd samples/opengl</span></li>
	<li>
	 <span style="font-family: monospace;">make</span></li>
	<li>
	 Ran samples/opengl/cube/cube.exe</li>
	<li>
	 Copied dlls that it complained about when double clicking the icon to the exe folder.
	(wxbase28u_gcc_custom.dll,wxmsw28u_core_gcc_custom.dll,wxmsw28u_gl_gcc_custom.dll)</li>
	<li>
	 Ran samples/opengl/cube/cube.exe</li>
	<li>
	 Saw cube. OpenGL must therefore work.
	</li>
	</ul>
</li>
<li>
 Ran <span style="font-family: monospace;">make install</span>
</li>
</ul>
<h4>zlib</h4>
<ul>
<li>
 ran <span style="font-family: monospace;">make -f win32/Makefile.gcc</span>
</li>
<li>
 Copied .h to C:\MinGW32\include\
</li>
<li>
 Copied zlib1.dll,libz.a,libzdll.a to C:\MinGW32\lib\
</li>
</ul>	
	
<h4>libpng</h4>
<ul>
<li>
 depends upon zlib, so do zlib first
</li>
<li>
 ran <span style="font-family: monospace;">make-f scripts/makefile.gcc</span>
</li>
<li>
 Copied .h to  C:\MinGW32\include\
</li>
<li>
 Copied libpng.a to c:\MinGW32\lib\
</li>
</ul>

<h4>libxml2</h4>
<ul>
<li>
 Ran<span style="font-family: monospace;"> ./configure</span>
	<li>
	-- Failure on libtoolT (I ignored this).
	</li>
	</li>
<li>
 Ran make
</li>
<li>
- Failed on testThreads.c. In that file, on line 110:
<span style="font-family: monospace;">  tid[i]= (pthread_t)-1; </span> should be
<span style="font-family: monospace;">
<pre>
	tid[i].p= NULL;
	tid[i].x=-1;
</pre>
</span>
	
	as pthread_t is a struct under windows ( see <a href="http://sourceware.org/pthreads-win32/faq.html">Pthreads faq</a>, Q11)
	looking in pthread.h:
<span style="font-family: monospace;">
<pre>
	typedef struct {
	    void  p;                   /* Pointer to actual object */
	    unsigned int x;             /* Extra information - reuse count etc */
	} ptw32_handle_t;
</pre>
	</li>
<li>
 Ran <span style="font-family: monospace;">make install</span>
</li>
</ul>
<h4>libfreetype</h4>
<ul>
<li>
 Ran <span style="font-family: monospace;">./configure</span>
</li>
<li>
 Ran <span style="font-family: monospace;">make</span>
</li>
<li>
 Ran <span style="font-family: monospace;">make install</span>
</li>
</ul>
<h4>ftgl</h4>
<ul>
<li>
 Edited configure
 <ul>
<li>
	--found "-lgl"  replaced with "-lopengl32".
	</li>
	<li>
	-- found "-lGLU" replaced with "-lGLU32"
	</li>
	<li>
	--openGL and GLU tests are broken. in "configure" replace char glBegin() with #include &lt;GL/gl.h&gt; and char gluNewTess (); with #include &lt;GL/glu.h&gt;, then remove the "return" specification from the function call. This will allow the GL and GLU tests to succeed.
		</li>
	</ul>
</li>
<li>
 Ran <span style="font-family: monospace;">./configure</span></li>
<li>
 <span style="font-family: monospace;">Make</span></li>
<li>
 <span style="font-family: monospace;">make install</span> (this installs into /usr/local/, which is not preferable, really)
	</li>
	</ul>
<h4>GSL</h4>
<ul>
<li> Ran <span style="font-family: monospace;">./configure</span></li>
<li> Ran <span style="font-family: monospace;">make</span></li>
<li> ran <span style="font-family: monospace;">make install</span></li>
</ul>

<h4>Mathgl</h4>
<ul>
<li>
(Depends GSL, do that before this)
 Ran <span style="font-family: monospace;">./configure</span>
</li>
<li>
  Ran Make
	<ul>
	<li>
	This failed in the utils dir. libpng is unable to see libz for whatever reason. Does not bode well,  but it was  in the utils section, which I don't need, so I ignored it.
		</li>
	</ul>
</li>
<li>
 Entered the "mgl" directory &amp; ran <span style="font-family: monospace;">make install</span>
</li>
<li>
 Entered the "include" directory &amp; ran <span style="font-family: monospace;">make install</span>
</li>
</ul>
<h4>3Depict</h4>
<ul>

<li>
 Ran <span style="font-family: monospace;"> export CFLAGS="-I/c/msys/1.0/local/include" && export LDFLAGS="-L/c/msys/1.0/local/lib" && ./configure --with-libqhull-link="-L/c/msys/1.0/local/lib/ -lqhull"  --with-libpng-link="-lpng -lz" </span>
	<ul>
	<li>
		 For an explanation as to why this "export" business is needed, see <a href="http://www.mingw.org/wiki/IncludePathHOWTO">this mingw faq</a>.	</li><li>
		-- This won't build with parallelism; you have to add <span style="font-family: monospace;">--enable-openmp-parallel </span> , however some versions of GCC do not like this, so I left it off by default.  If you get errors about <span style="font-family: monospace;">undefined __sync_compare_and_swap_4  </span>(or similar) you can either 1) Alter your optimisation level 2) rebuild with -march=i686 3) modify the files it complains from, and build only those files without paralellism (modify cflags and remove -D_GLIBCXX... and -fopenmp , or 4) just build the whole thing without parallelism (the default).</li><li>
		 These settings will enable slow debug checking. To turn off debug checking add  <span style="font-family: monospace;">--enable-no-debug-checks</span> after configure, as in <span style="font-family: monospace;">./configure --enable-no-debug-checks</span>. Full information is available in <span style="font-family: monospace;">./configure --help</span>.
	</li>
	</ul>
</li>
<li>
 Ran <span style="font-family: monospace;">make</span>
</li>
<li>
 Modified pngread.h to remove windows specific path
</li>
<li>
 Modified c:\msys\1.0\include\mgl\mgl_data.h to add #undef NO_GSL immediately before #ifndef NO_GSL
</li>
<li>
 Re-ran <span style="font-family: monospace;">make</span> -- this generates the "exe" file.
</li>

<li>
Double clicked program

<ul>
<li>
	-- Put missing DLL it complained about in the same dir. Kept doing this until it stopped whinging about dlls
</li>
</ul>
</li>
</ul>
</div></div>

</body></html>
